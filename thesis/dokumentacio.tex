\chapter{Program dokumentáció}

Ebben a fejezetben a diplomamunkához tartozó program felhasználói, és
fejlesztõi dokumentációját ismertetjük.

\section{Felhasználói dokumentáció}

\subsection{Telepítés}

A program telepítése kétféleképpen történhet: a \emph{cabal-install}
nevû csomagkezelõvel, vagy anélkül. A sikeres telepítéshez a szükséges
Haskell csomagokat\footnote{A \emph{gtk}, a \emph{svgcairo} és a
\emph{cairo} csomagok egy helyrõl, a gtk2hs projekt honlapjáról
letölthetõek:
\href{http://www.haskell.org/gtk2hs/}{http://www.haskell.org/gtk2hs/},
a többi csomag
mind elérhetõ a HackageDB-rõl:
\href{http://hackage.haskell.org}{http://hackage.haskell.org}}
és a minimum verzió követelményeket \aref{tab:csomagok} tábla mutatja.

\begin{table}[htb]
  \label{tab:csomagok}
  \begin{center}
    \begin{tabular}{| r | l |}
      \hline
      \bf csomag neve & \bf minimum verzió \\
      \hline
      \hline
      base & 4.1.0.0 \\
      \hline
      containers & 0.2.0.0 \\
      \hline
      cabal & 1.6 \\
      \hline
      value-supply & 0.5 \\
      \hline
      lazysmallcheck & 0.3 \\
      \hline
      haskell-src & 1.0.1.2 \\
      \hline
      ipprint & 0.3 \\
      \hline
      fgl & 5.4.2.2 \\
      \hline
      pretty & 1.0.1.0 \\
      \hline
      graphviz & 2009.5.* \\
      \hline
      \hline
      strict-concurrency & 0.2.1 \\
      \hline
      parallel & 1.1.0.1 \\
      \hline
      directory & 1.0.0.3 \\
      \hline
      process & 1.0.1.1 \\
      \hline
      gtk & 0.10.0 \\
      svgcairo & 0.10.0 \\
      cairo & 0.10.0 \\
      \hline
    \end{tabular}
  \end{center}
  \caption{A sikeres telepítéshez szükséges Haskell csomagok. Az alsó
    részben levõ csomagok a futtatható programhoz szükséges, a többi
    pedig a könyvtárcsomagokhoz is.}
\end{table}

\subsubsection{Telepítés \emph{cabal-install}-al}

A forráskódot tartalmazó könyvtárba lépve (ahol a
\tt{visual-graphrewrite.cabal} fájl található) a következõ parancsot
kell kiadni:

\begin{verbatim}
cabal install
\end{verbatim}

\subsubsection{Telepítés \emph{cabal-install} nélkül}

A telepítés három fõ lépésbõl áll. Elõször is a forráskódot tartalmazó
könyvtárba lépve (ahol a \tt{visual-graphrewrite.cabal} fájl
található) a következõ parancsot kell kiadni:

\begin{verbatim}
runhaskell Setup.lhs configure
\end{verbatim}

Ez a parancs leellenõrzi a szükséges függõségek meglétét, és beállítja
a fordításhoz szükséges paramétereket. A következõ parancs lefordítja
a forráskódot, és elkészíti a linkelhetõ könyvtárcsomagokat és a
futtatható binárist:

\begin{verbatim}
runhaskell Setup.lhs build
\end{verbatim}

Ekkor már használható állapotban van a program, azonban a megfelelõ
helyre másoláshoz, telepítéshez a szükséges jogosultságok megszerzése
után a

\begin{verbatim}
runhaskell Setup.lhs install
\end{verbatim}

parancs futtatása szükséges.

\subsection{A program használata}

A futtatható bináris alapesetben a \emph{visual-graphrewrite} nevet
kapja. Amennyiben ez elérhetõ a \tt{PATH} környezeti változó egyik
könyvtárából, akkor a következõképpen használható:

\begin{verbatim}
visual-graphrewrite modul.hs
\end{verbatim}

A parancssori argumentumokról egy rövid összefoglalót kapunk a
következõ parancs kiadásával (a következõ részlet mutatja a parancs
kimenetét is):

\begin{verbatim}
$ visual-graphrewrite --help
visual-graphrewrite: unrecognized option `--help'
Usage: visual-graphrewrite [OPTION...] files...
  -v       --verbose      verbose output on stderr
  -d       --debug        show debug info on stdout
  -V, -?   --version      show version number
  -i FILE  --input=FILE   input FILE
  -m TERM  --main=TERM    main term on which to perform rewriting
\end{verbatim}

Az opciók rövid leírását \aref{tab:opciok} táblázat tartalmazza. Két
fõ mûködési módja van a programnak. Ha nincs megadva kezdeti
kifejezés, ahonnan indíthatnánk az átírást, akkor a szabályok jobb
oldalait jeleníti meg. Ha megadtuk ezt a kifejezést, akkor
természetesen az átírási folyamatot elindítja, és az egyes lépéseket
jeleníti meg a képernyõn. A bemeneti Haskell modul forrását vagy a
standard bemeneten várja a program, vagy amennyiben megadunk egy
fájlnevet, onnan beolvassa.

\begin{table}[htb]
  \begin{center}
    \begin{tabular}{|m{2.5cm}|m{6cm}||p{4cm}|}
      \hline
      \multicolumn{2}{|c||}{\bf Az opció és magyarázata} & \bf Példa a használatára \\
      \hline
      \hline
      \begin{verbatim}-v\end{verbatim} vagy \begin{verbatim}--verbose\end{verbatim} & Hiba esetén részletesebb információt ír a program a standard hiba kimenetre
      & \tt{visual-graphrewrite --verbose modul.hs} \\ \hline
      \begin{verbatim}-d\end{verbatim} vagy \begin{verbatim}--debug\end{verbatim} & Részletesebb információkat ír a program belsõ mûködésérõl a standard kimenetre
      & \tt{visual-graphrewrite --debug modul.hs} \\ \hline
      \begin{verbatim}-V\end{verbatim} vagy \begin{verbatim}-?\end{verbatim} vagy \begin{verbatim}--version\end{verbatim} & A program kiírja a verzióját és kilép
      & \tt{visual-graphrewrite --version} \\ \hline
      \begin{verbatim}-i FILE\end{verbatim} vagy \begin{verbatim}--input=FILE\end{verbatim} vagy \begin{verbatim}FILE\end{verbatim}& FILE a bemenetként funkcionáló Haskell modul forráskódját tartalmazó fájl neve. Ha nincs megadva, akkor a standard bemeneten várja a program a modul forrását.
      & \tt{visual-graphrewrite --input=modul.hs} \\ \hline
      \begin{verbatim}-m TERM\end{verbatim} vagy \begin{verbatim}--main=TERM\end{verbatim} & TERM az átírás kezdeti pontjaként értelmezett tetszõleges Haskell kifejezés
      & \tt{visual-graphrewrite --main='take 10 primes' --input=primes.hs} \\ \hline
      \hline
    \end{tabular}
  \end{center}
  \caption{A futtatható program által támogatott parancssori argumentumok leírása.}
  \label{tab:opciok}
\end{table}

Indítás után a program megnyit egy ablakot, melyen a verziószám és a
kezeléshez szükséges billentyûk emlékeztetõje található. Minden
esetben a megjelenített gráfokat egy fába rendezve jeleníti meg a
program, mindig csak egy gráfot. A fában az aktuális csúcs
legbaloldalabbi gyerekére a \tt{d} billentyûvel léphetünk. Egy adott
csúcs testvérei között jobbra a \tt{r}, balra a \tt{l} billentyûvel
válogathatunk. Visszalépni a szülõ csúcsra a \tt{u} billentyûvel
lehet. Kilépéshez a \tt{q} gombot kell megnyomni. Kényelmi szempontból
hasznos a \tt{space} gomb, melynek funkcionalitása megegyezik a \tt{l}
billentyûjével, illetve a \tt{backspace}, mely a \tt{r} gombot
utánozza.

\section{Fejlesztõi dokumentáció}

A könyvtárcsomag felépítéséhez, és az egyes modulok áttekintéséhez
szükséges információ megtalálható \aref{chap:impl} fejezetben. A
program könyvtárcsomagként való használatához elég importálni a
\emph{GraphRewrite} modult, amely újraexportálja a nyilvánosan
használható függvényeket, adattípusokat.

A \emph{Language.Haskell.Parser} modul által produkált
\emph{ParseResult} típusból egyszerûen tudunk leegyszerûsített
reprezentációjú Haskell modult csinálni a \emph{convParse}
függvénnyell. Az ennek eredményeképpen kapott modult a \emph{rename}
függvény áttranszformálja úgy, hogy a szöveg azonosítók helyére
mindenhol egyedi számokat ír, illetve visszaadja a szöveg
$\rightarrow$ szám összekapcsolásokat is. Ezekbõl a
\emph{makeRewriteSystem} függvény egy gráfátíró rendszert készít,
melyet aztán felhasználhatunk az átíráshoz. Magukat a redukciós
lépéseket a \emph{rewriteStepFine} függvény segítségével lehet
elvégezni, melynek meg kell adni egy kezdõ kifejezést is, és visszaad
egy fát az átírási lépésekkel.

A következõ kódrészlet egy olyan esetet mutat be, melyben egy konstans
szövegben található Haskell modulból készítünk gráfátíró rendszert:

\begin{verbatim}
predef = map snd deltaNames
sup = unsafePerformIO newEnumSupply :: Supply Int
(ids, ids2, ids3) = split3 sup

(Ok (predefBinds,_,_)) = distributeIds predef ids2

m = parseModule "result = f 1; f 5 = 5; f a = f (succ a)"
renamed = rename' predefBinds (convParse m) ids3
(Ok (n,sm)) = renamed
rs = makeRewriteSystem sm n
\end{verbatim}

A \emph{distributeIds} függvény a $\delta$-függvényekhez rendel
azonosítókat ugyanúgy, mint ahogy a rename függvény a moduloknál.

%% Local Variables:
%% coding: latin-2
%% End:
